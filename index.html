<!DOCTYPE html>
<html lang="id">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Folkpresso | The Community Coffee</title>

    <link rel="manifest" href="manifest.json">
    <meta name="theme-color" content="#1e3a8a">
    <meta name="mobile-web-app-capable" content="yes">
    <meta name="apple-mobile-web-app-capable" content="yes">
    <meta name="apple-mobile-web-app-status-bar-style" content="black-translucent">
    <link rel="apple-touch-icon" href="https://cdn-icons-png.flaticon.com/512/751/751621.png">
    
    <script src="https://www.gstatic.com/firebasejs/10.7.1/firebase-app-compat.js"></script>
    <script src="https://www.gstatic.com/firebasejs/10.7.1/firebase-auth-compat.js"></script>
    <script src="https://www.gstatic.com/firebasejs/10.7.1/firebase-firestore-compat.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/@supabase/supabase-js@2"></script>
    <script src="https://cdn.tailwindcss.com"></script>

    <script>
        tailwind.config = {
            darkMode: 'class',
            theme: {
                extend: {
                    fontFamily: { sans: ['Plus Jakarta Sans', 'sans-serif'] }
                }
            }
        }
    </script>

    <link href="https://fonts.googleapis.com/css2?family=Plus+Jakarta+Sans:wght@400;600;700;800&display=swap" rel="stylesheet">

    <style>
        .no-scrollbar::-webkit-scrollbar { display: none; }
        @keyframes slideUp { from { transform: translateY(20px); opacity: 0; } to { transform: translateY(0); opacity: 1; } }
        @keyframes marquee { 0% { transform: translateX(100%); } 100% { transform: translateX(-100%); } }
        @keyframes popIn { 0% { transform: scale(0.5); opacity: 0; } 80% { transform: scale(1.1); opacity: 1; } 100% { transform: scale(1); opacity: 1; } }
        @keyframes brewBounce { 0%, 100% { transform: translateY(0); } 50% { transform: translateY(-10px); } }
        .app-page { display: none; }
        .app-page.active { display: block; animation: slideUp 0.4s ease-out; }
        .glass-nav { background: rgba(255, 255, 255, 0.95); backdrop-filter: blur(12px); border-bottom: 1px solid rgba(0,0,0,0.05); }
        .dark .glass-nav { background: rgba(15, 23, 42, 0.95); border-bottom: 1px solid rgba(255,255,255,0.1); }
        .animate-marquee { display: inline-block; white-space: nowrap; animation: marquee 20s linear infinite; }
        .anim-brew { animation: brewBounce 1s infinite ease-in-out; }
        .member-card-bronze { background: linear-gradient(135deg, #CD7F32, #8B4513); color: #FFF; }
        #toast-container { position: fixed; bottom: 100px; left: 50%; transform: translateX(-50%); z-index: 9999; pointer-events: none; width: 100%; display: flex; flex-direction: column; align-items: center; }
        .toast { background: #1e3a8a; color: white; padding: 12px 24px; border-radius: 50px; margin-top: 10px; font-size: 12px; font-weight: bold; box-shadow: 0 10px 25px rgba(0,0,0,0.2); animation: popIn 0.3s forwards; }
        #payment-modal, #tracking-modal { z-index: 10000; }
    </style>
</head>
<body class="bg-[#F8FAFC] text-slate-900 pb-32 dark:bg-slate-950 dark:text-white transition-colors duration-300 font-sans select-none">

    <div id="toast-container"></div>

    <div id="payment-modal" class="fixed inset-0 hidden items-center justify-center p-6 backdrop-blur-md bg-black/40">
        <div class="bg-white dark:bg-slate-900 w-full max-w-md rounded-[2.5rem] p-8 shadow-2xl">
            <h3 class="text-2xl font-black text-center text-blue-900 dark:text-white mb-6">Metode Pembayaran</h3>
            <div class="space-y-3">
                <button onclick="processPayment('Cash')" class="w-full bg-green-500 text-white py-4 rounded-2xl font-bold shadow-lg">üíµ Cash</button>
                <button onclick="processPayment('QRIS')" class="w-full bg-blue-500 text-white py-4 rounded-2xl font-bold shadow-lg">üì± QRIS</button>
                <button onclick="closePaymentModal()" class="w-full bg-slate-200 dark:bg-slate-700 text-slate-700 dark:text-white py-4 rounded-2xl font-bold">Batal</button>
            </div>
        </div>
    </div>

    <div id="tracking-modal" class="fixed inset-0 hidden items-center justify-center p-6 backdrop-blur-md bg-black/40">
        <div class="bg-white dark:bg-slate-900 w-full max-w-md rounded-[2.5rem] p-8 shadow-2xl text-center">
            <div id="brew-state">
                <div class="text-6xl mb-4 anim-brew">‚òï</div>
                <h3 class="text-2xl font-black text-blue-900 dark:text-white mb-2">Memproses...</h3>
                <div class="w-full bg-slate-200 dark:bg-slate-700 h-3 rounded-full overflow-hidden mt-4">
                    <div id="anim-bar" class="h-full bg-blue-600 transition-all duration-[3000ms]" style="width: 0%"></div>
                </div>
            </div>
            <div id="finish-state" class="hidden flex-col items-center">
                <div class="text-6xl mb-4">‚úÖ</div>
                <h3 class="text-2xl font-black text-green-600 mb-2">Pesanan Selesai!</h3>
                <button onclick="finishOrder()" class="w-full bg-blue-900 text-white py-4 rounded-2xl font-black mt-4">Selesai</button>
            </div>
        </div>
    </div>

    <div id="login-screen" class="fixed inset-0 z-[5000] bg-gradient-to-br from-blue-700 to-blue-900 flex flex-col items-center justify-center p-6 transition-all duration-500">
        <div class="mb-8 p-6 bg-white rounded-[2.5rem] shadow-2xl animate-bounce">
            <img src="https://cdn-icons-png.flaticon.com/512/751/751621.png" class="w-20 h-20">
        </div>
        <h1 class="text-5xl font-extrabold text-white mb-3 italic">Folkpresso</h1>
        <button onclick="loginWithGoogle()" class="w-full max-w-xs bg-white text-blue-900 font-bold py-4 rounded-2xl shadow-xl flex items-center justify-center gap-4">
            <img src="https://www.gstatic.com/firebasejs/ui/2.0.0/images/action/google.svg" class="w-6 h-6">
            <span id="login-text">Masuk dengan Google</span>
        </button>
    </div>

    <div id="main-app" class="hidden">
        <header class="glass-nav sticky top-0 z-[60]">
            <div class="px-6 py-4 flex justify-between items-center">
                <h1 class="text-xl font-extrabold text-blue-900 dark:text-blue-400 italic">FOLKPRESSO</h1>
                <div class="flex gap-2">
                    <button onclick="toggleDark()" class="bg-slate-100 dark:bg-slate-800 p-2.5 rounded-2xl">üåô</button>
                    <button onclick="showPage('admin')" class="bg-blue-100 dark:bg-blue-900/30 p-2.5 rounded-2xl text-blue-600">üìä</button>
                </div>
            </div>
        </header>

        <main id="home-page" class="app-page active">
            <div class="px-6 mt-4 flex items-center justify-between">
                <div class="flex items-center gap-3">
                    <img id="profile-photo-nav" src="https://cdn-icons-png.flaticon.com/512/847/847969.png" class="w-10 h-10 rounded-full border-2 border-blue-500">
                    <div>
                        <p class="text-[10px] text-slate-400 font-bold uppercase">Halo,</p>
                        <h2 id="home-username" class="text-sm font-black text-blue-900 dark:text-white italic">Guest</h2>
                    </div>
                </div>
                <div class="bg-blue-100 px-3 py-1 rounded-full"><span id="home-points" class="text-xs font-bold text-blue-800">0</span> ‚≠ê</div>
            </div>
            <div class="px-6 mt-8 pb-10 space-y-4" id="product-list"></div>
        </main>

        <main id="cart-page" class="app-page px-6 pt-8">
            <h2 class="text-2xl font-black text-center mb-6">Keranjang</h2>
            <div id="cart-items" class="space-y-3"></div>
            <div class="mt-8 p-6 bg-white dark:bg-slate-900 rounded-[2.5rem] shadow-xl border">
                <div class="flex justify-between items-center mb-4"><span class="font-bold text-xs uppercase text-slate-400">Total</span><span id="cart-total" class="text-xl font-black">Rp 0</span></div>
                <button onclick="openPayment()" class="w-full bg-blue-900 text-white py-4 rounded-2xl font-black">Checkout</button>
            </div>
        </main>

        <main id="profile-page" class="app-page p-6">
            <h3 class="text-xl font-black mb-6">Profil</h3>
            <div id="member-card" class="member-card-bronze rounded-[2rem] p-6 h-48 flex flex-col justify-between mb-6">
                <h2 id="tier-name" class="text-xl font-black">BRONZE MEMBER</h2>
                <div class="text-2xl font-black"><span id="display-points">0</span> Poin</div>
            </div>
            <button onclick="logout()" class="w-full bg-red-100 text-red-600 py-4 rounded-2xl font-bold">Keluar Akun</button>
        </main>

        <main id="admin-page" class="app-page p-6">
            <h3 class="text-xl font-black">Dashboard Admin</h3>
            <p class="text-slate-500 mt-4 italic">Halaman admin sedang dalam pemeliharaan.</p>
            <button onclick="showPage('home')" class="mt-6 bg-blue-900 text-white px-6 py-3 rounded-xl">Kembali ke Menu</button>
        </main>

        <nav class="fixed bottom-0 left-0 right-0 z-[80] glass-nav p-4 flex justify-around">
            <button onclick="showPage('home')" id="btn-home" class="flex flex-col items-center text-blue-900">üè†<span class="text-[10px] font-bold">Menu</span></button>
            <button onclick="showPage('cart')" id="btn-cart" class="flex flex-col items-center text-slate-400">üõí<span class="text-[10px] font-bold">Cart</span></button>
            <button onclick="showPage('profile')" id="btn-profile" class="flex flex-col items-center text-slate-400">üòé<span class="text-[10px] font-bold">Profile</span></button>
        </nav>
    </div>

    <script>
        // --- CONFIG FIREBASE ---
        const firebaseConfig = {
          apiKey: "AIzaSyBR_Er6zVysY-J-ht8PMpKRW0FJ69utN3w",
          authDomain: "folkpresso.firebaseapp.com",
          projectId: "folkpresso",
          storageBucket: "folkpresso.firebasestorage.app",
          messagingSenderId: "728120023418",
          appId: "1:728120023418:web:62c8b1271da8af8a67dec3"
        };
        firebase.initializeApp(firebaseConfig);
        const auth = firebase.auth();
        const db = firebase.firestore();

        let currentUser = "Guest";
        let cart = [];

        // --- AUTH ---
        auth.onAuthStateChanged((user) => {
            if (user) {
                document.getElementById('login-screen').classList.add('hidden');
                document.getElementById('main-app').classList.remove('hidden');
                startSync(user.uid);
            } else {
                document.getElementById('login-screen').classList.remove('hidden');
                document.getElementById('main-app').classList.add('hidden');
            }
        });

        window.loginWithGoogle = function() {
            const provider = new firebase.auth.GoogleAuthProvider();
            auth.signInWithPopup(provider).catch(e => alert(e.message));
        };

        function startSync(uid) {
            db.collection("users").doc(uid).onSnapshot((doc) => {
                if (doc.exists) {
                    const data = doc.data();
                    document.getElementById('home-username').innerText = data.customName || "Friend";
                    document.getElementById('home-points').innerText = (data.points || 0).toLocaleString();
                    const dp = document.getElementById('display-points');
                    if(dp) dp.innerText = (data.points || 0).toLocaleString();
                }
            });
        }

        // --- PRODUCT ---
        const products = [
            { name: "Aren Coffee", price: 15000 },
            { name: "Salted Caramel", price: 15000 },
            { name: "Matcha Latte", price: 15000 }
        ];

        window.onload = function() {
            const container = document.getElementById('product-list');
            if(!container) return;
            container.innerHTML = products.map(p => `
                <div class="bg-white dark:bg-slate-900 p-4 rounded-3xl flex justify-between items-center shadow-sm border border-slate-100 dark:border-slate-800">
                    <div><h4 class="font-bold">${p.name}</h4><p class="text-blue-600 text-xs">Rp ${p.price.toLocaleString()}</p></div>
                    <button onclick="addToCart('${p.name}', ${p.price})" class="bg-blue-900 text-white w-10 h-10 rounded-xl font-bold">+</button>
                </div>
            `).join('');
        };

        window.addToCart = function(name, price) {
            const item = cart.find(i => i.name === name);
            if(item) item.quantity++; else cart.push({name, price, quantity: 1});
            showToast(name + " ditambahkan!");
        };

        function renderCart() {
            const list = document.getElementById('cart-items');
            if(!list) return;
            let total = 0;
            list.innerHTML = cart.map(item => {
                total += item.price * item.quantity;
                return `<div class="bg-white dark:bg-slate-900 p-4 rounded-2xl flex justify-between">
                    <span class="font-bold">${item.name} (x${item.quantity})</span>
                    <span>Rp ${(item.price * item.quantity).toLocaleString()}</span>
                </div>`;
            }).join('') || '<p class="text-center italic text-slate-400">Keranjang kosong</p>';
            document.getElementById('cart-total').innerText = 'Rp ' + total.toLocaleString();
        }

        // --- PEMBAYARAN ---
        window.openPayment = function() {
            if(!cart.length) return showToast("Keranjang kosong!");
            const modal = document.getElementById('payment-modal');
            if(modal) { modal.classList.remove('hidden'); modal.classList.add('flex'); }
        };

        window.closePaymentModal = function() {
            const modal = document.getElementById('payment-modal');
            if(modal) modal.classList.add('hidden');
        };

        window.processPayment = function(method) {
            closePaymentModal();
            const track = document.getElementById('tracking-modal');
            if(track) {
                track.classList.remove('hidden'); track.classList.add('flex');
                document.getElementById('anim-bar').style.width = "100%";
                setTimeout(() => {
                    document.getElementById('brew-state').classList.add('hidden');
                    document.getElementById('finish-state').classList.remove('hidden');
                    document.getElementById('finish-state').classList.add('flex');
                }, 3000);
            }
        };

        window.finishOrder = function() { location.reload(); };

        // --- NAVIGASI (DENGAN PENGECEKAN SAFETY) ---
        window.showPage = function(id) {
            const target = document.getElementById(id + '-page');
            
            // HANYA JALANKAN JIKA ELEMEN ADA
            if (target) {
                document.querySelectorAll('.app-page').forEach(p => p.classList.remove('active'));
                target.classList.add('active');

                // Update warna icon nav
                document.querySelectorAll('nav button').forEach(b => b.classList.replace('text-blue-900', 'text-slate-400'));
                const btn = document.getElementById('btn-' + id);
                if(btn) btn.classList.replace('text-slate-400', 'text-blue-900');

                if(id === 'cart') renderCart();
            } else {
                console.error("Error: Halaman " + id + "-page tidak ditemukan!");
                showToast("Halaman belum tersedia");
            }
        };

        function showToast(msg) {
            const container = document.getElementById('toast-container');
            if(!container) return;
            const t = document.createElement('div');
            t.className = 'toast'; t.innerText = msg;
            container.appendChild(t);
            setTimeout(() => t.remove(), 2500);
        }

        window.toggleDark = function() { document.documentElement.classList.toggle('dark'); };
        window.logout = function() { auth.signOut().then(() => location.reload()); };
    </script>
</body>
</html>