<!DOCTYPE html>
<html lang="id">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>FOLKPRESSO - Share Stories Share Laughter </title>

    <link rel="manifest" href="manifest.json">
    <meta name="theme-color" content="#1e3a8a">
    <meta name="mobile-web-app-capable" content="yes">
    <meta name="apple-mobile-web-app-capable" content="yes">
    <meta name="apple-mobile-web-app-status-bar-style" content="black-translucent">
    <link rel="apple-touch-icon" href="img/FPLOGO.png">
    <link rel="icon" href="logo.png">

    <script src="https://www.gstatic.com/firebasejs/10.7.1/firebase-app-compat.js"></script>
    <script src="https://www.gstatic.com/firebasejs/10.7.1/firebase-auth-compat.js"></script>
    <script src="https://www.gstatic.com/firebasejs/10.7.1/firebase-firestore-compat.js"></script>
    <script src="https://www.gstatic.com/firebasejs/10.7.1/firebase-messaging-compat.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/@supabase/supabase-js@2"></script>
    <!-- Midtrans Snap JS (Production) -->
    <script src="https://app.midtrans.com/snap/snap.js" data-client-key="Mid-client-eqKF-nDs2VYSLE84"></script>
    <script src="https://cdn.tailwindcss.com"></script>
    <script>
        tailwind.config = {
            darkMode: 'class',
            theme: { extend: { fontFamily: { sans: ['Plus Jakarta Sans', 'sans-serif'] } } }
        };
    </script>
    <!-- Midtrans Snap.js Sandbox -->
    <!-- Midtrans Snap.js (Removed: Using Core API) -->
    <!-- <script src="https://app.midtrans.com/snap/snap.js" data-client-key="Mid-client-eqKF-nDs2VYSLE84"></script> -->

    <link href="https://fonts.googleapis.com/css2?family=Plus+Jakarta+Sans:wght@400;600;700;800&display=swap"
        rel="stylesheet">

    <link rel="stylesheet" href="style.css">
</head>

<body
    class="bg-[#EDF2FA] text-slate-900 pb-24 dark:bg-slate-950 dark:text-white transition-colors duration-300 font-sans select-none">

    <div id="toast-container"></div>

    <!-- ===== SPLASH SCREEN ===== -->
    <div id="splash-screen"
        class="fixed inset-0 z-[10000] flex flex-col items-center justify-center bg-slate-950 transition-opacity duration-700 opacity-100">
        <div class="relative w-32 h-32 mb-6">
            <div class="absolute inset-0 bg-blue-600 rounded-full blur-2xl opacity-20 animate-pulse"></div>
            <img src="img/logo.png" alt="Folkpresso"
                class="w-full h-full object-contain relative z-10 drop-shadow-2xl animate-bounce-slow">
        </div>
        <h1 class="text-2xl font-black text-white tracking-widest uppercase mb-8">Folkpresso</h1>
        <div class="flex gap-1">
            <div class="w-2 h-2 bg-blue-500 rounded-full animate-bounce delay-75"></div>
            <div class="w-2 h-2 bg-blue-500 rounded-full animate-bounce delay-150"></div>
            <div class="w-2 h-2 bg-blue-500 rounded-full animate-bounce delay-300"></div>
        </div>
        <p class="absolute bottom-10 text-[10px] text-slate-500 font-bold tracking-[0.3em] uppercase">Brewing Happiness
        </p>
    </div>

    <!-- ===== WELCOME CARD POPUP (CAROUSEL) ===== -->
    <div id="welcome-screen"
        class="fixed inset-0 z-[9000] hidden items-center justify-center bg-slate-900/30 backdrop-blur-2xl p-6 transition-all duration-700 opacity-0">
        <div
            class="bg-white dark:bg-slate-900 w-full max-w-sm rounded-[3rem] p-8 shadow-[0_20px_50px_rgba(0,0,0,0.3)] dark:shadow-[0_20px_50px_rgba(0,0,0,0.5)] relative overflow-hidden text-center transform scale-95 transition-transform duration-500">

            <!-- Slide 1: Greeting -->
            <div id="welcome-slide-1" class="welcome-slide transition-opacity duration-300">
                <div
                    class="w-16 h-16 bg-blue-50 dark:bg-slate-800 rounded-full flex items-center justify-center text-3xl mx-auto mb-4 shadow-sm">
                    üëã</div>
                <h3 id="welcome-greeting-text" class="text-xl font-black text-blue-900 dark:text-white mb-2">Selamat
                    Pagi!</h3>
                <h2 id="welcome-username-text" class="text-2xl font-black text-slate-900 dark:text-blue-400 mb-6">
                    Guest</h2>
                <button onclick="nextWelcomeSlide(2)"
                    class="bg-blue-600 text-white w-12 h-12 rounded-full shadow-lg flex items-center justify-center mx-auto hover:scale-110 transition-transform">‚ûú</button>
            </div>

            <!-- Slide 2: Stamp Collector -->
            <div id="welcome-slide-2" class="welcome-slide hidden transition-opacity duration-300">
                <div
                    class="w-16 h-16 bg-amber-50 dark:bg-slate-800 rounded-full flex items-center justify-center text-3xl mx-auto mb-6 shadow-sm">
                    ‚ú®</div>
                <h2 class="text-xl font-black text-slate-800 dark:text-white mb-4 px-2">Lengkapi stamp coffee mu yuk
                    jangan lupa.</h2>
                <p class="text-sm text-blue-600 dark:text-blue-400 font-bold mb-8 uppercase tracking-wider">Jadilah
                    bagian dari Collector</p>

                <div class="flex justify-center">
                    <button onclick="nextWelcomeSlide(3)"
                        class="bg-blue-600 text-white w-12 h-12 rounded-full shadow-lg flex items-center justify-center hover:scale-110 transition-transform">‚ûú</button>
                </div>
            </div>

            <!-- Slide 3: Recommendation -->
            <div id="welcome-slide-3" class="welcome-slide hidden transition-opacity duration-300">
                <div class="relative w-24 h-24 mx-auto mb-4">
                    <div class="absolute inset-0 bg-blue-500 rounded-full blur-xl opacity-20 animate-pulse"></div>
                    <img id="welcome-rec-img-slide" src="img/gula aren.png"
                        class="w-full h-full object-cover rounded-full shadow-lg relative z-10 border-4 border-white dark:border-slate-800">
                </div>
                <h3 class="text-xs font-bold text-blue-500 uppercase tracking-widest mb-1">Rekomendasi Hari Ini</h3>
                <h2 id="welcome-rec-name-slide" class="text-xl font-black text-slate-900 dark:text-white mb-6">Aren
                    Latte</h2>
                <button onclick="dismissWelcome()"
                    class="w-full bg-blue-900 dark:bg-blue-600 text-white py-3.5 rounded-2xl font-black shadow-lg active:scale-95 transition-all">
                    Gas Pesan Sekarang! üöÄ
                </button>
            </div>

            <!-- Dots Indicator -->
            <div class="flex justify-center gap-1 mt-6">
                <div id="dot-1" class="w-2 h-2 rounded-full bg-blue-500 transition-all"></div>
                <div id="dot-2" class="w-2 h-2 rounded-full bg-slate-200 dark:bg-slate-700 transition-all"></div>
                <div id="dot-3" class="w-2 h-2 rounded-full bg-slate-200 dark:bg-slate-700 transition-all"></div>
            </div>
        </div>
    </div>

    <!-- ===== EXIT CONFIRMATION MODAL ===== -->
    <div id="exit-modal"
        class="fixed inset-0 z-[9999] hidden items-center justify-center bg-black/60 backdrop-blur-sm p-6 transition-all duration-300 opacity-0">
        <div
            class="bg-white/95 dark:bg-slate-900/95 backdrop-blur-md w-full max-w-xs rounded-[2.5rem] p-8 shadow-2xl transform scale-90 transition-transform duration-300 text-center relative overflow-hidden">
            <div class="absolute top-0 left-0 w-full h-2 bg-gradient-to-r from-red-500 via-orange-500 to-yellow-500">
            </div>
            <div
                class="w-16 h-16 bg-red-50 dark:bg-red-900/20 rounded-full flex items-center justify-center mx-auto mb-4 text-3xl shadow-sm">
                üö™</div>
            <h3 id="exit-modal-title" class="text-xl font-black text-slate-800 dark:text-white mb-2">Mau Keluar?</h3>
            <p id="exit-modal-msg" class="text-sm text-slate-500 dark:text-slate-400 mb-8 font-medium">Yakin nih mau
                ninggalin Folkpresso?
                Nanti kangen loh... ü•∫</p>
            <div class="flex gap-3">
                <button onclick="closeExitModal()"
                    class="flex-1 bg-slate-100 dark:bg-slate-800 text-slate-600 dark:text-slate-300 py-3.5 rounded-2xl font-bold text-sm tracking-wide active:scale-95 transition-all">Nanti
                    Aja</button>
                <button id="exit-modal-confirm-btn" onclick="confirmExitApp()"
                    class="flex-1 bg-red-600 text-white py-3.5 rounded-2xl font-bold text-sm shadow-lg shadow-red-500/30 active:scale-95 transition-all">Ya,
                    Keluar</button>
            </div>
        </div>
    </div>

    <div id="universal-popup" class="fixed inset-0 hidden items-center justify-center p-6 backdrop-blur-md bg-black/40">
        <div class="bg-white dark:bg-slate-900 w-full max-w-xs rounded-[2.5rem] p-8 shadow-2xl transform scale-50 opacity-0 transition-all duration-300"
            id="popup-content">
            <div id="popup-icon" class="text-5xl text-center mb-4">‚ú®</div>
            <h3 id="popup-title" class="text-xl font-black text-center text-blue-900 dark:text-white mb-2">Pemberitahuan
            </h3>
            <p id="popup-message" class="text-sm text-center text-slate-500 dark:text-slate-400 mb-6 font-medium">Pesan
                di sini...</p>
            <div id="popup-actions" class="w-full"></div>
        </div>
    </div>

    <div id="payment-modal"
        class="fixed inset-0 hidden z-[9999] flex items-center justify-center p-6 backdrop-blur-md bg-black/50 transition-all duration-300 opacity-0 pointer-events-none">
        <div
            class="bg-white dark:bg-slate-900 w-full max-w-sm rounded-[2.5rem] p-8 shadow-2xl transform scale-95 transition-all duration-300 border border-slate-100 dark:border-slate-800">
            <div class="text-center mb-8">
                <h3 class="text-2xl font-black text-blue-900 dark:text-white mb-2">Metode Pembayaran</h3>
                <p class="text-slate-500 dark:text-slate-400 text-xs font-medium">Pilih cara bayar yang kamu suka</p>
            </div>

            <div class="space-y-3">
                <button onclick="processPayment('gopay')"
                    class="gopay-glow group w-full min-h-[85px] flex items-center justify-between bg-white dark:bg-slate-800 p-5 rounded-2xl border-2 border-slate-100 dark:border-slate-700 active:scale-[0.98] transition-all shadow-sm">
                    <div class="flex items-center space-x-4">
                        <img src="https://upload.wikimedia.org/wikipedia/commons/8/86/Gopay_logo.svg" alt="GoPay"
                            class="h-7 w-auto object-contain dark:invert dark:grayscale">
                    </div>
                    <span
                        class="text-[9px] font-black bg-blue-100 dark:bg-blue-900/30 text-blue-700 dark:text-blue-400 px-3 py-1.5 rounded-lg uppercase tracking-wider">Instant</span>
                </button>

                <button onclick="processPayment('other_qris')"
                    class="qris-glow group w-full min-h-[85px] flex items-center justify-between bg-white dark:bg-slate-800 p-5 rounded-2xl border-2 border-slate-100 dark:border-slate-700 active:scale-[0.98] transition-all shadow-sm">
                    <div class="flex items-center space-x-4">
                        <img src="https://upload.wikimedia.org/wikipedia/commons/a/a2/Logo_QRIS.svg" alt="QRIS"
                            class="h-8 w-auto object-contain">
                        <div class="text-left">
                            <span class="block font-black text-xs text-slate-700 dark:text-slate-200 uppercase">QRIS
                                Dinamis</span>
                            <span class="text-[9px] text-slate-400 font-medium">Scan e-wallet apa saja</span>
                        </div>
                    </div>
                    <span
                        class="text-[9px] font-black bg-emerald-100 dark:bg-emerald-900/30 text-emerald-700 dark:text-emerald-400 px-3 py-1.5 rounded-lg uppercase tracking-wider">Otomatis</span>
                </button>
            </div>
            <button onclick="closePaymentModal()"
                class="w-full bg-slate-50 dark:bg-slate-800 text-slate-500 dark:text-slate-400 py-4 rounded-2xl font-black text-xs mt-6 active:scale-95 transition-all border border-transparent dark:border-slate-700 uppercase tracking-widest">Kembali</button>
        </div>
    </div>


    <!-- ===== LOGIN SCREEN ===== -->
    <div id="login-screen"
        class="hidden opacity-0 transition-opacity duration-700 absolute inset-0 z-[8000] flex flex-col items-center justify-center p-6 bg-gradient-to-br from-slate-900 via-blue-950 to-slate-900">
        <div class="w-full max-w-sm flex flex-col items-center justify-center text-center">
            <div
                class="flex items-center justify-center w-28 h-28 bg-white/10 backdrop-blur-lg rounded-[2.5rem] shadow-2xl mb-4 overflow-hidden border border-white/20 mx-auto">
                <img src="img/logo.png" alt="Folkpresso Logo" class="w-16 h-16 object-contain">
            </div>
            <h1
                class="text-4xl font-black text-white tracking-widest drop-shadow-[0_5px_15px_rgba(255,255,255,0.4)] mb-10 text-center w-full">
                FOLKPRESSO</h1>
        </div>

        <div class="bg-white/10 backdrop-blur-3xl rounded-[3rem] p-8 shadow-2xl border border-white/10 w-full">
            <!-- Tab Switcher -->
            <div class="flex bg-black/30 rounded-2xl p-1 mb-8">
                <button id="tab-btn-login" onclick="switchAuthTab('login')"
                    class="flex-1 py-3 rounded-xl text-xs font-black uppercase tracking-widest transition-all duration-300 bg-white text-blue-900 shadow-xl">
                    Masuk
                </button>
                <button id="tab-btn-register" onclick="switchAuthTab('register')"
                    class="flex-1 py-3 rounded-xl text-xs font-black uppercase tracking-widest transition-all duration-300 text-white/50">
                    Daftar
                </button>
            </div>

            <!-- ===== TAB: MASUK (LOGIN) ===== -->
            <div id="tab-login">
                <h2 class="text-2xl font-black text-white text-center mb-1">Selamat Datang!</h2>
                <p class="text-xs text-white/60 text-center mb-8 font-medium">Masuk untuk meraih poin & kebahagiaan</p>

                <div class="space-y-4 mb-8">
                    <div class="flex items-center gap-3 bg-slate-50 rounded-2xl px-4 py-3.5 border border-slate-100">
                        <span class="text-slate-400">üìß</span>
                        <input id="login-email" type="email" placeholder="Email"
                            class="bg-transparent flex-1 text-sm font-medium outline-none placeholder-slate-300">
                    </div>
                    <div class="flex items-center gap-3 bg-slate-50 rounded-2xl px-4 py-3.5 border border-slate-100">
                        <span class="text-slate-400">üîí</span>
                        <input id="login-password" type="password" placeholder="Kata Sandi"
                            class="bg-transparent flex-1 text-sm font-medium outline-none placeholder-slate-300">
                    </div>
                </div>

                <p id="login-error" class="text-red-500 text-xs font-semibold text-center mb-3 hidden"></p>

                <button onclick="loginWithEmail()"
                    class="w-full bg-blue-700 hover:bg-blue-800 text-white font-bold py-4 rounded-2xl shadow-lg active:scale-95 transition-all mb-4">
                    <span id="login-text">Masuk</span>
                </button>

                <div class="flex items-center gap-3 mb-4">
                    <div class="flex-1 h-px bg-slate-200"></div>
                    <span class="text-xs text-slate-400 font-semibold">atau</span>
                    <div class="flex-1 h-px bg-slate-200"></div>
                </div>

                <button onclick="loginWithGoogle()"
                    class="w-full flex items-center justify-center gap-3 bg-slate-50 hover:bg-slate-100 border border-slate-200 py-3.5 rounded-2xl transition-all active:scale-95 mb-4">
                    <img src="https://upload.wikimedia.org/wikipedia/commons/3/3c/Google_Favicon_2025.svg"
                        class="w-5 h-5">
                    <span class="text-sm font-bold text-slate-600">Masuk dengan Google</span>
                </button>

                <p class="text-center text-xs text-slate-400">Belum punya akun? <span
                        class="text-blue-600 font-bold cursor-pointer" onclick="switchAuthTab('register')">Daftar
                        Sekarang</span></p>
            </div>

            <!-- ===== TAB: DAFTAR (REGISTER) ===== -->
            <div id="tab-register" class="hidden">
                <h2 class="text-xl font-extrabold text-slate-800 text-center mb-2">Buat Akun Baru</h2>
                <p class="text-sm text-slate-400 text-center mb-6">Daftar dan mulai kumpulkan poin!</p>

                <div class="space-y-4 mb-5">
                    <div class="flex items-center gap-3 bg-slate-50 rounded-2xl px-4 py-3.5 border border-slate-100">
                        <span class="text-slate-400">üìß</span>
                        <input id="reg-email" type="email" placeholder="Email"
                            class="bg-transparent flex-1 text-sm font-medium outline-none placeholder-slate-300">
                    </div>
                    <div class="flex items-center gap-3 bg-slate-50 rounded-2xl px-4 py-3.5 border border-slate-100">
                        <span class="text-slate-400">üîí</span>
                        <input id="reg-password" type="password" placeholder="Kata Sandi (min. 6 karakter)"
                            class="bg-transparent flex-1 text-sm font-medium outline-none placeholder-slate-300">
                    </div>
                    <div class="flex items-center gap-3 bg-slate-50 rounded-2xl px-4 py-3.5 border border-slate-100">
                        <span class="text-slate-400">üì±</span>
                        <span class="text-sm font-bold text-slate-500">+62</span>
                        <input id="reg-phone" type="tel" placeholder="8xxxxxxxxxx"
                            class="bg-transparent flex-1 text-sm font-medium outline-none placeholder-slate-300">
                    </div>
                </div>

                <p id="reg-error" class="text-red-500 text-xs font-semibold text-center mb-3 hidden"></p>

                <button onclick="registerWithEmail()"
                    class="w-full bg-emerald-600 hover:bg-emerald-700 text-white font-bold py-4 rounded-2xl shadow-lg active:scale-95 transition-all mb-4">
                    <span id="reg-text">Daftar Sekarang</span>
                </button>

                <p class="text-center text-xs text-slate-400">Sudah punya akun? <span
                        class="text-blue-600 font-bold cursor-pointer" onclick="switchAuthTab('login')">Masuk</span>
                </p>
            </div>

        </div>
    </div>

    </div>

    <!-- ===== MAIN APP ===== -->
    <div id="main-app" class="hidden">

        <!-- HEADER -->
        <header class="kopiku-header">
            <div class="px-5 py-4 flex justify-between items-center">
                <h1 class="text-xl font-extrabold text-blue-900 dark:text-blue-400 tracking-tight">FOLKPRESSO</h1>
                <div class="flex items-center gap-3">
                    <div id="store-status-badge" class="hidden"><span
                            class="w-2 h-2 bg-green-500 rounded-full animate-pulse"></span></div>

                    <button onclick="toggleDark()"
                        class="w-9 h-9 flex items-center justify-center bg-slate-100 dark:bg-slate-800 rounded-xl text-sm">üåô</button>
                    <div onclick="showPage('profile'); setTimeout(() => document.getElementById('notification-section')?.scrollIntoView({behavior: 'smooth'}), 100);"
                        class="w-9 h-9 flex items-center justify-center bg-blue-50 dark:bg-slate-800 rounded-xl text-sm cursor-pointer relative">
                        üîî
                        <span id="notif-badge"
                            class="hidden absolute top-0 right-0 w-2.5 h-2.5 bg-red-500 rounded-full border-2 border-white dark:border-slate-900"></span>
                    </div>
                </div>
            </div>
        </header>

        <!-- Marquee Global (terlihat di semua halaman: order, quest, tier up, multi-user) -->
        <div class="bg-blue-900 dark:bg-blue-950 py-2 overflow-hidden border-b border-blue-800/50">
            <div id="marquee-text" class="animate-marquee text-xs font-bold text-blue-200 tracking-wide">
                üî• Fuel Your Day With a Perfect Blend! &nbsp;&nbsp; ‚Ä¢ &nbsp;&nbsp; FOLKPRESSO Open!
            </div>
        </div>

        <!-- ===== HOME PAGE ===== -->
        <main id="home-page" class="app-page active">
            <!-- User Greeting -->
            <div class="px-5 mt-4 flex items-center justify-between">
                <div class="flex items-center gap-3">
                    <img id="profile-photo-nav" src="https://cdn-icons-png.flaticon.com/512/847/847969.png"
                        class="w-11 h-11 rounded-full border-2 border-blue-500 object-cover shadow-sm">
                    <div>
                        <p class="text-[10px] text-slate-400 font-bold uppercase tracking-widest">Halo, FOLK-ers!</p>
                        <h2 id="home-username"
                            class="text-sm font-extrabold text-blue-900 dark:text-white truncate max-w-[140px]">Guest
                        </h2>
                    </div>
                </div>
                <div onclick="window.showPage('profile')"
                    class="points-card px-4 py-2.5 flex items-center gap-2 cursor-pointer shadow-lg">
                    <span class="text-xl"></span>
                    <div>
                        <p class="text-[9px] font-medium opacity-80">Your Points</p>
                        <p id="home-points" class="text-lg font-extrabold leading-tight">0</p>
                    </div>
                    <span class="text-white/60 ml-1">‚Ä∫</span>
                </div>
            </div>

            <!-- Special Offer Banner -->
            <div class="px-5 mt-5">
                <div class="relative rounded-[2rem] overflow-hidden h-44 shadow-xl group">
                    <div id="banner-slider" class="flex transition-transform duration-700 ease-in-out h-full">

                        <div class="w-full h-full shrink-0 relative">
                            <img src="img/1st rend.png" class="w-full h-full object-cover">
                            <div
                                class="absolute inset-0 bg-gradient-to-r from-blue-900/90 to-transparent flex items-center p-6">
                                <div>
                                    <p class="text-[10px] font-bold text-blue-200 uppercase tracking-widest mb-1">
                                        Special Offer</p>
                                    <h3 class="text-white font-extrabold text-lg leading-tight">30% Off All
                                        Lattes<br>With Membership!</h3>
                                </div>
                            </div>
                        </div>

                        <div class="w-full h-full shrink-0 relative">
                            <img src="https://images.unsplash.com/photo-1509042239860-f550ce71551c?w=800"
                                class="w-full h-full object-cover">
                            <div
                                class="absolute inset-0 bg-gradient-to-r from-orange-900/90 to-transparent flex items-center p-6">
                                <div>
                                    <p class="text-[10px] font-bold text-orange-200 uppercase tracking-widest mb-1">
                                        Weekend Vibes</p>
                                    <h3 class="text-white font-extrabold text-lg leading-tight">Free Donut For<br>Every
                                        Signature Drink!</h3>
                                </div>
                            </div>
                        </div>

                        <div class="w-full h-full shrink-0 relative">
                            <img src="https://images.unsplash.com/photo-1495474472287-4d71bcdd2085?w=800"
                                class="w-full h-full object-cover">
                            <div
                                class="absolute inset-0 bg-gradient-to-r from-emerald-900/90 to-transparent flex items-center p-6">
                                <div>
                                    <p class="text-[10px] font-bold text-emerald-200 uppercase tracking-widest mb-1">
                                        Folkpresso Info</p>
                                    <h3 class="text-white font-extrabold text-lg leading-tight">Now Serving At<br>Parung
                                        Area! üìç</h3>
                                </div>
                            </div>
                        </div>

                    </div>

                    <div class="absolute bottom-3 left-1/2 -translate-x-1/2 flex gap-1.5">
                        <div class="banner-dot w-4 h-2 rounded-full bg-white opacity-100 transition-all duration-300">
                        </div>
                        <div class="banner-dot w-2 h-2 rounded-full bg-white opacity-40 transition-all duration-300">
                        </div>
                        <div class="banner-dot w-2 h-2 rounded-full bg-white opacity-40 transition-all duration-300">
                        </div>
                    </div>
                </div>
            </div>

            <!-- Redesigned Feature Cards -->
            <div class="px-5 mt-6 grid grid-cols-2 gap-4">
                <div onclick="openPassport()"
                    class="relative overflow-hidden bg-white dark:bg-slate-900 rounded-[2rem] p-5 border border-slate-100 dark:border-slate-800 shadow-sm active:scale-95 transition-all cursor-pointer group">
                    <div
                        class="absolute -right-2 -top-2 w-16 h-16 bg-blue-100 dark:bg-blue-900/20 rounded-full blur-2xl group-hover:scale-150 transition-transform duration-500">
                    </div>
                    <div class="relative flex flex-col items-start gap-2">
                        <div
                            class="w-10 h-10 rounded-2xl bg-blue-50 dark:bg-blue-900/30 flex items-center justify-center text-xl shadow-inner">
                            üìñ</div>
                        <div>
                            <h4 class="font-black text-xs text-slate-800 dark:text-white uppercase tracking-tight">
                                Folk's Booklet</h4>
                            <p id="passport-status" class="text-[9px] text-blue-500 font-bold mt-0.5">0 / 0 Stamps</p>
                        </div>
                    </div>
                </div>
                <div onclick="claimQuest()" id="quest-card"
                    class="relative overflow-hidden bg-white dark:bg-slate-900 rounded-[2rem] p-5 border border-slate-100 dark:border-slate-800 shadow-sm active:scale-95 transition-all cursor-pointer group">
                    <div
                        class="absolute -right-2 -top-2 w-16 h-16 bg-orange-100 dark:bg-orange-900/20 rounded-full blur-2xl group-hover:scale-150 transition-transform duration-500">
                    </div>
                    <div class="relative flex flex-col items-start gap-2">
                        <div
                            class="w-10 h-10 rounded-2xl bg-orange-50 dark:bg-orange-900/30 flex items-center justify-center text-xl shadow-inner">
                            ‚öîÔ∏è</div>
                        <div>
                            <h4 class="font-black text-xs text-slate-800 dark:text-white uppercase tracking-tight">Daily
                                Reward</h4>
                            <p id="quest-status" class="text-[9px] text-orange-500 font-bold mt-0.5">Klaim +50 Poin</p>
                        </div>
                    </div>
                </div>
            </div>

            <!-- Popular Now -->
            <div class="px-5 mt-7">
                <div class="flex justify-between items-center mb-4">
                    <h3 class="text-base font-extrabold text-slate-800 dark:text-white">Popular Now üî•</h3>
                    <span onclick="showPage('menu')" class="text-xs font-bold text-blue-600 cursor-pointer">See All
                        ‚Üí</span>
                </div>
            </div>

            <div class="px-5 pb-10 space-y-3" id="product-list"></div>
        </main>

        <!-- ===== MENU PAGE ===== -->
        <main id="menu-page" class="app-page">
            <div class="px-5 pt-6 pb-3 flex items-center gap-3">
                <button onclick="showPage('home')"
                    class="w-10 h-10 bg-white dark:bg-slate-800 rounded-xl flex items-center justify-center shadow-sm text-lg">‚Üê</button>
                <h2 class="text-xl font-extrabold text-slate-800 dark:text-white flex-1">Daftar Menu</h2>
                <button
                    class="w-10 h-10 bg-white dark:bg-slate-800 rounded-xl flex items-center justify-center shadow-sm text-sm">‚öôÔ∏è</button>
            </div>

            <div class="px-5 mb-4 flex gap-2 overflow-x-auto no-scrollbar" id="menu-category-tabs">
                <span class="category-pill active" onclick="filterMenu('all')">All</span>
                <span class="category-pill" onclick="filterMenu('signature')">Signature</span>
                <span class="category-pill" onclick="filterMenu('classic')">Classic</span>
                <span class="category-pill" onclick="filterMenu('non-coffee')">Non-Coffee</span>
            </div>

            <div class="px-5 mb-5">
                <div
                    class="bg-white dark:bg-slate-800 rounded-2xl px-4 py-3 flex items-center gap-3 shadow-sm border border-slate-100 dark:border-slate-700">
                    <span class="text-slate-400">üîç</span>
                    <input type="text" placeholder="Search menu..." id="menu-search" oninput="searchMenu(this.value)"
                        class="bg-transparent flex-1 text-sm font-medium outline-none placeholder-slate-300 dark:text-white">
                </div>
            </div>

            <div class="px-5 pb-10 grid grid-cols-2 gap-3" id="menu-product-grid"></div>
        </main>

        <!-- ===== CART PAGE ===== -->
        <main id="cart-page" class="app-page">
            <div class="px-5 pt-6 pb-3 flex items-center gap-3">
                <button onclick="showPage('home')"
                    class="w-10 h-10 bg-white dark:bg-slate-800 rounded-xl flex items-center justify-center shadow-sm text-lg">‚Üê</button>
                <h2 class="text-xl font-extrabold text-blue-900 dark:text-white flex-1">Keranjang Anda</h2>
            </div>

            <div class="px-5">
                <!-- Alamat Pengiriman -->
                <div
                    class="bg-white dark:bg-slate-900 p-4 rounded-[1.5rem] border border-slate-100 dark:border-slate-800 mb-4">
                    <div class="flex items-center gap-2 mb-1">
                        <span>üìç</span>
                        <span class="text-xs font-bold text-slate-500 dark:text-slate-400">Alamat Pengiriman</span>
                    </div>
                    <p id="cart-address-display" class="text-sm font-bold text-slate-800 dark:text-white">Belum diatur
                    </p>
                    <p class="text-[10px] text-blue-600 font-bold mt-1 cursor-pointer" onclick="showPage('profile')">
                        Ubah di Profile ‚Üí</p>
                </div>

                <div id="cart-items" class="space-y-3 min-h-[100px]"></div>

                <div
                    class="mt-6 bg-white dark:bg-slate-900 rounded-[1.5rem] p-5 shadow-lg border border-slate-100 dark:border-slate-800">
                    <div class="space-y-3 mb-4">
                        <div class="flex justify-between text-sm"><span
                                class="text-slate-400 font-medium">Subtotal</span><span id="cart-total"
                                class="font-extrabold text-slate-800 dark:text-white">Rp 0</span></div>
                        <div id="voucher-row" class="hidden flex justify-between text-sm"><span
                                class="text-green-500 font-medium">üé´ Voucher</span><span id="voucher-discount-display"
                                class="font-extrabold text-green-500">- Rp 0</span></div>
                        <div class="flex justify-between text-sm"><span class="text-slate-400 font-medium">Biaya
                                Pengiriman</span><span class="font-extrabold text-green-500">Gratis</span></div>
                        <div
                            class="border-t border-slate-100 dark:border-slate-700 pt-3 flex justify-between text-base">
                            <span class="font-bold text-slate-600 dark:text-slate-300">Total Pembayaran</span><span
                                class="font-extrabold text-blue-900 dark:text-blue-400 text-lg" id="cart-total-final">Rp
                                0</span>
                        </div>
                    </div>
                    <!-- Voucher Button -->
                    <div id="voucher-section" class="mb-3">
                        <button onclick="toggleVoucherPanel()" id="btn-voucher"
                            class="w-full bg-amber-50 dark:bg-slate-800 border-2 border-dashed border-amber-300 dark:border-amber-600 py-3 rounded-2xl font-bold text-xs text-amber-600 dark:text-amber-400 active:scale-95 transition-all flex items-center justify-center gap-2">
                            üé´ <span id="voucher-btn-text">Pakai Voucher</span>
                        </button>
                        <div id="voucher-panel" class="hidden mt-2 space-y-2"></div>
                    </div>
                    <button onclick="window.openPayment()"
                        class="w-full bg-blue-600 hover:bg-blue-700 dark:bg-blue-600 dark:hover:bg-blue-500 text-white py-4 rounded-2xl font-black shadow-lg active:scale-95 transition-transform mt-2">
                        Lanjutkan Pembayaran
                    </button>
                </div>
            </div>
        </main>

        <!-- ===== PROFILE PAGE ===== -->
        <main id="profile-page" class="app-page p-5">
            <div class="flex items-center justify-between mb-6">
                <h3 class="text-xl font-extrabold text-slate-800 dark:text-white">Your Profile</h3>
                <div class="flex gap-2">
                    <button onclick="showWrapped()"
                        class="px-4 h-9 bg-slate-900 dark:bg-white text-white dark:text-slate-900 text-[10px] font-black rounded-xl shadow-lg transition-all active:scale-95 flex items-center gap-2 uppercase tracking-tighter">
                        <span>üéÅ</span> Wrapped
                    </button>
                </div>
            </div>

            <div class="flex items-center gap-4 mb-6">
                <div class="w-16 h-16 rounded-full border-3 border-blue-500 overflow-hidden shadow-lg bg-blue-50">
                    <img id="profile-photo-display" src="https://cdn-icons-png.flaticon.com/512/847/847969.png"
                        class="w-full h-full object-cover">
                </div>
                <div>
                    <h4 id="profile-display-name" class="text-lg font-extrabold text-slate-800 dark:text-white">Guest
                    </h4>
                    <p class="text-xs text-slate-400 font-medium">REKAN FOLK</p>
                </div>
            </div>

            <div id="gopay-binding-section"
                class="mt-4 mb-10 p-4 bg-blue-50 dark:bg-slate-800 rounded-2xl border border-blue-100 dark:border-slate-700">
                <div class="flex items-center justify-between">
                    <div class="flex items-center gap-3">
                        <img src="https://upload.wikimedia.org/wikipedia/commons/8/86/Gopay_logo.svg"
                            class="h-5 dark:invert dark:grayscale transition-all duration-300"> <span
                            id="gopay-status-text" class="text-xs font-bold text-blue-900 dark:text-white">
                            Akun Belum Terhubung
                        </span>
                    </div>
                    <button onclick="bindGoPay()" id="btn-bind-gopay"
                        class="bg-blue-600 text-white px-4 py-2 rounded-xl text-[10px] font-black shadow-md active:scale-95 transition-all">Hubungkan</button>
                </div>
            </div>

            <div id="member-card"
                class="member-card-bronze rounded-[2rem] pt-10 px-6 pb-4 shadow-2xl relative overflow-hidden h-52 flex flex-col justify-between transition-all duration-500 mb-6">
                <div>
                    <p class="text-[10px] font-bold uppercase tracking-widest opacity-80">Status Member</p>
                    <h2 id="tier-name" class="text-2xl font-black mt-1">BRONZE MEMBER</h2>
                </div>

                <div class="mt-auto">
                    <div class="flex justify-between items-center mb-2">
                        <span class="text-xs font-bold opacity-80">Total Poin</span>
                        <span id="display-points" class="text-xl font-black">0</span>
                    </div>
                    <div class="w-full bg-white/20 h-2 rounded-full overflow-hidden">
                        <div id="level-bar" class="h-full bg-white transition-all duration-1000" style="width: 0%">
                        </div>
                    </div>
                </div>
            </div>

            <!-- Biodata -->
            <div
                class="bg-white dark:bg-slate-900 rounded-[1.5rem] p-5 border border-slate-100 dark:border-slate-800 mb-5">
                <h4 class="font-extrabold text-sm mb-4 text-slate-700 dark:text-white">üìù Biodata</h4>
                <div class="space-y-3">
                    <div>
                        <label class="text-[10px] font-bold text-slate-400 uppercase tracking-widest mb-1 block">Name
                        </label>
                        <input type="text" id="bio-name"
                            class="w-full bg-slate-50 dark:bg-slate-800 border border-slate-100 dark:border-slate-700 rounded-xl p-3 text-sm font-bold outline-none focus:ring-2 focus:ring-blue-500 dark:text-white"
                            placeholder="Masukkan nama lengkap...">
                    </div>
                    <div>
                        <label
                            class="text-[10px] font-bold text-slate-400 uppercase tracking-widest mb-1 block">Email</label>
                        <input type="email" id="bio-email" readonly
                            class="w-full bg-slate-100 dark:bg-slate-800 border border-slate-100 dark:border-slate-700 rounded-xl p-3 text-sm font-medium outline-none text-slate-400 dark:text-slate-500 cursor-not-allowed">
                    </div>
                    <div>
                        <label class="text-[10px] font-bold text-slate-400 uppercase tracking-widest mb-1 block">üì±
                            WhatsApp Number</label>
                        <div
                            class="flex items-center gap-2 bg-slate-50 dark:bg-slate-800 border border-slate-100 dark:border-slate-700 rounded-xl px-3 py-3">
                            <span class="text-sm font-bold text-slate-500">+62</span>
                            <input type="tel" id="bio-phone"
                                class="bg-transparent flex-1 text-sm font-bold outline-none dark:text-white"
                                placeholder="8xxxxxxxxxx">
                        </div>
                    </div>
                    <div>
                        <label class="text-[10px] font-bold text-slate-400 uppercase tracking-widest mb-1 block">üìç
                            Adress</label>
                        <div class="flex gap-2">
                            <textarea id="input-address" rows="2"
                                class="w-full bg-slate-50 dark:bg-slate-800 border border-slate-100 dark:border-slate-700 rounded-xl p-3 text-sm font-medium outline-none focus:ring-2 focus:ring-blue-500 resize-none dark:text-white"
                                placeholder="Alamat (Otomatis dari GPS)"></textarea>
                        </div>
                        <input type="text" id="input-address-detail"
                            class="mt-2 w-full bg-slate-50 dark:bg-slate-800 border border-slate-100 dark:border-slate-700 rounded-xl p-3 text-sm font-medium outline-none focus:ring-2 focus:ring-blue-500 dark:text-white"
                            placeholder="Detail Lokasi (No. Rumah, RT/RW, Patokan...)">

                        <button onclick="getGPSAddress()" id="btn-gps"
                            class="mt-1 text-[10px] text-green-600 font-bold flex items-center gap-1">
                            üì° Use GPS
                        </button>
                        <p id="gps-status" class="text-[10px] text-slate-400 mt-1 hidden"></p>
                    </div>
                </div>
                <button onclick="saveBiodata()"
                    class="w-full bg-blue-600 hover:bg-blue-700 text-white py-3 rounded-xl font-bold text-xs active:scale-95 transition-all mt-4">
                    Simpan
                </button>
                <p id="bio-save-info" class="text-[10px] text-slate-400 mt-2 text-center">*Isi biodata anda dengan benar
                </p>
            </div>

            <!-- Notifikasi -->
            <div
                class="bg-white dark:bg-slate-900 rounded-[1.5rem] p-5 border border-slate-100 dark:border-slate-800 mb-5">
                <h4 class="font-extrabold text-sm mb-3 text-slate-700 dark:text-white">üîî Notifikasi</h4>
                <div id="notif-list" class="space-y-2 max-h-60 overflow-y-auto no-scrollbar">
                    <p class="text-xs text-slate-400 italic text-center py-4">Belum ada notifikasi</p>
                </div>
            </div>

            <!-- Riwayat Pesanan -->
            <div
                class="bg-white dark:bg-slate-900 rounded-[1.5rem] p-5 border border-slate-100 dark:border-slate-800 mb-5">
                <div class="flex items-center justify-between mb-3">
                    <h4 class="font-extrabold text-sm text-slate-700 dark:text-white">üìã Riwayat Pesanan</h4>
                    <button onclick="loadOrderHistory()" class="text-[10px] font-bold text-blue-600">Refresh</button>
                </div>
                <div id="order-history-list" class="space-y-2 max-h-72 overflow-y-auto no-scrollbar">
                    <p class="text-xs text-slate-400 italic text-center py-4">Klik Refresh untuk melihat riwayat</p>
                </div>
            </div>

            <!-- Install App Button (Hidden by default) -->
            <button id="btn-install-app" onclick="installPWA()"
                class="hidden w-full bg-slate-800 text-white py-4 rounded-2xl font-bold transition-colors border border-slate-700 mb-3 flex items-center justify-center gap-2">
                üì≤ Install Aplikasi
            </button>

            <!-- Logout -->
            <button onclick="logout()"
                class="w-full bg-red-50 hover:bg-red-100 text-red-500 py-4 rounded-2xl font-bold transition-colors border border-red-100">
                Keluar Akun
            </button>
        </main>

        <!-- ===== BOTTOM NAV ===== -->
        <nav class="fixed bottom-0 left-0 right-0 z-[80] glass-nav py-2 px-4">
            <div class="flex justify-around">
                <button onclick="showPage('home')" id="btn-home" class="bottom-nav-item active">
                    <div class="nav-icon">üè†</div>
                    <span class="text-[10px] font-bold mt-1">Home</span>
                </button>
                <button onclick="showPage('menu')" id="btn-menu" class="bottom-nav-item">
                    <div class="nav-icon">üìã</div>
                    <span class="text-[10px] font-bold mt-1">Menu</span>
                </button>
                <button onclick="showPage('cart')" id="btn-cart" class="bottom-nav-item relative">
                    <div class="nav-icon">üõí</div>
                    <span class="text-[10px] font-bold mt-1">Cart</span>
                </button>
                <button onclick="showPage('profile')" id="btn-profile" class="bottom-nav-item relative">
                    <div class="nav-icon">üë§</div>
                    <div id="notif-badge"
                        class="absolute top-1 right-4 w-2.5 h-2.5 bg-red-500 rounded-full hidden border border-white dark:border-slate-900">
                    </div>
                    <span class="text-[10px] font-bold mt-1">Profile</span>
                </button>
            </div>
        </nav>
    </div>

    <!-- ===== PRODUCT CUSTOMIZATION MODAL ===== -->
    <div id="product-modal"
        class="fixed inset-0 z-[100] hidden items-end sm:items-center justify-center p-4 bg-black/60 backdrop-blur-sm">
        <div class="bg-white dark:bg-slate-900 w-full max-w-sm rounded-[2.5rem] p-6 shadow-2xl slide-up relative">
            <button onclick="closeProductModal()"
                class="absolute top-4 right-4 w-8 h-8 bg-slate-100 dark:bg-slate-800 rounded-full text-slate-500 font-bold hover:bg-slate-200">‚úï</button>

            <div class="flex items-start gap-4 mb-6">
                <img id="pm-image" src="" class="w-20 h-20 rounded-2xl object-cover shadow-sm bg-slate-50">
                <div>
                    <h3 id="pm-name" class="text-lg font-extrabold text-slate-900 dark:text-white leading-tight">Product
                        Name</h3>
                    <p id="pm-price" class="text-blue-600 dark:text-blue-400 font-black text-base mt-1">Rp 0</p>
                    <p id="pm-desc" class="text-xs text-slate-400 mt-1 line-clamp-2">Deskripsi produk singkat...</p>
                </div>
            </div>

            <div class="space-y-5 mb-8 overflow-y-auto max-h-[50vh] pr-1">
                <!-- Sweetness Level -->
                <div id="opt-sweetness">
                    <h4 class="text-sm font-bold text-slate-700 dark:text-white mb-3">Sugar options</h4>
                    <div class="grid grid-cols-4 gap-2">
                        <button onclick="selectSugar('0%')" id="sugar-0"
                            class="sugar-btn py-3 rounded-xl border-2 border-slate-100 dark:border-slate-700 text-xs font-bold text-slate-500 dark:text-slate-400 hover:bg-slate-50 dark:hover:bg-slate-800 transition-colors">0%</button>
                        <button onclick="selectSugar('50%')" id="sugar-50"
                            class="sugar-btn py-3 rounded-xl border-2 border-slate-100 dark:border-slate-700 text-xs font-bold text-slate-500 dark:text-slate-400 hover:bg-slate-50 dark:hover:bg-slate-800 transition-colors">50%</button>
                        <button onclick="selectSugar('75%')" id="sugar-75"
                            class="sugar-btn py-3 rounded-xl border-2 border-slate-100 dark:border-slate-700 text-xs font-bold text-slate-500 dark:text-slate-400 hover:bg-slate-50 dark:hover:bg-slate-800 transition-colors">75%</button>
                        <button onclick="selectSugar('Normal')" id="sugar-normal"
                            class="sugar-btn active py-3 rounded-xl border-2 border-blue-500 bg-blue-50 text-blue-600 text-xs font-bold hover:bg-blue-100 transition-colors">Normal</button>
                    </div>
                </div>

                <!-- Quantity -->
                <div>
                    <h4 class="text-sm font-bold text-slate-700 dark:text-white mb-3">Jumlah</h4>
                    <div class="flex items-center gap-4">
                        <button onclick="updateModalQty(-1)"
                            class="w-10 h-10 rounded-xl bg-slate-100 dark:bg-slate-800 font-bold text-lg">-</button>
                        <span id="pm-qty" class="text-xl font-black text-slate-900 dark:text-white">1</span>
                        <button onclick="updateModalQty(1)"
                            class="w-10 h-10 rounded-xl bg-blue-600 text-white font-bold text-lg">+</button>
                    </div>
                </div>
            </div>

            <button onclick="confirmAddToCart()"
                class="w-full bg-blue-900 dark:bg-blue-600 text-white py-4 rounded-2xl font-black shadow-lg active:scale-95 transition-transform">
                Tambah ke Keranjang - <span id="pm-total">Rp 0</span>
            </button>
        </div>
    </div>

    <!-- ===== COMPLETE PROFILE MODAL (MANDATORY) ===== -->
    <div id="complete-profile-modal"
        class="fixed inset-0 z-[11000] hidden items-center justify-center p-6 backdrop-blur-md bg-black/80">
        <div
            class="bg-white dark:bg-slate-900 w-full max-w-sm rounded-[2.5rem] p-8 shadow-2xl relative overflow-hidden">
            <!-- Decorative Header -->
            <div class="absolute top-0 left-0 w-full h-2 bg-gradient-to-r from-blue-500 to-emerald-500"></div>

            <div class="text-center mb-6">
                <div
                    class="w-16 h-16 bg-blue-50 dark:bg-slate-800 rounded-full flex items-center justify-center text-3xl mx-auto mb-3 shadow-sm">
                    üìù
                </div>
                <h3 class="text-xl font-black text-blue-900 dark:text-white">Lengkapi Profil</h3>
                <p class="text-xs text-slate-500 dark:text-slate-400 font-medium px-4">
                    Mohon lengkapi data berikut agar pesanan & pengiriman lancar.
                </p>
            </div>

            <div class="space-y-4">
                <!-- Phone Field (Only shows if missing) -->
                <div id="cp-phone-container" class="hidden">
                    <label class="text-[10px] font-bold text-slate-400 uppercase tracking-widest mb-1 block">
                        üì± Nomor WhatsApp (Wajib)
                    </label>
                    <div
                        class="flex items-center gap-2 bg-slate-50 dark:bg-slate-800 border border-slate-200 dark:border-slate-700 rounded-xl px-3 py-3 focus-within:ring-2 focus-within:ring-blue-500 transition-all">
                        <span class="text-sm font-bold text-slate-500">+62</span>
                        <input type="tel" id="cp-phone"
                            class="bg-transparent flex-1 text-sm font-bold outline-none dark:text-white"
                            placeholder="8xxxxxxxxxx">
                    </div>
                    <p class="text-[9px] text-red-500 mt-1 italic">*Nomor HP akan dikunci setelah disimpan.</p>
                </div>

                <!-- Address Field (Only shows if missing) -->
                <div id="cp-address-container" class="hidden">
                    <label class="text-[10px] font-bold text-slate-400 uppercase tracking-widest mb-1 block">
                        üìç Alamat Pengiriman
                    </label>
                    <textarea id="cp-address" rows="2"
                        class="w-full bg-slate-50 dark:bg-slate-800 border border-slate-200 dark:border-slate-700 rounded-xl p-3 text-sm font-medium outline-none focus:ring-2 focus:ring-blue-500 resize-none dark:text-white"
                        placeholder="Nama Jalan, Blok, Nomor Rumah..."></textarea>

                    <button onclick="getGPSAddressForModal()"
                        class="mt-2 w-full flex items-center justify-center gap-2 bg-emerald-50 dark:bg-emerald-900/20 text-emerald-600 dark:text-emerald-400 py-2 rounded-xl text-[10px] font-bold border border-emerald-100 dark:border-emerald-800 active:scale-95 transition-all">
                        üì° Gunakan GPS Saat Ini
                    </button>
                    <p id="cp-gps-status" class="text-[9px] text-slate-400 mt-1 text-center hidden">Mencari lokasi...
                    </p>
                </div>
            </div>

            <button onclick="saveMissingData()"
                class="w-full bg-blue-600 hover:bg-blue-700 text-white py-4 rounded-2xl font-black shadow-lg active:scale-95 transition-all mt-6">
                Simpan Data
            </button>
        </div>
    </div>

    <script src="script.js"></script>
    <div id="notif-modal"
        class="fixed inset-0 z-[10000] hidden items-center justify-center p-6 backdrop-blur-md bg-black/60">
        <div
            class="bg-white dark:bg-slate-900 w-full max-w-xs rounded-[2.5rem] p-8 shadow-2xl text-center transform transition-all duration-300">
            <div class="text-5xl mb-4">üîî</div>
            <h3 class="text-xl font-black text-blue-900 dark:text-white mb-2">Aktifkan Notifikasi?</h3>
            <p class="text-sm text-slate-500 dark:text-slate-400 mb-6 font-medium">Dapatkan info pesanan siap dan promo
                eksklusif Folkpresso langsung di HP-mu!</p>
            <div class="space-y-2">
                <button onclick="handleSubscribe()"
                    class="w-full bg-blue-600 text-white py-3.5 rounded-2xl font-bold shadow-lg active:scale-95 transition-all">Ya,
                    Aktifkan</button>
                <button onclick="closeNotifModal()" class="w-full text-slate-400 text-xs font-bold py-2">Nanti
                    Saja</button>
            </div>
        </div>
    </div>
    <div id="wrapped-modal"
        class="fixed inset-0 z-[5000] hidden items-center justify-center p-4 bg-slate-950/95 backdrop-blur-2xl transition-all duration-500">
        <div
            class="bg-slate-900 w-full max-w-sm rounded-[3rem] overflow-hidden shadow-2xl relative border border-white/5 flex flex-col max-h-[90vh]">
            <!-- Decorative Background -->
            <div
                class="absolute inset-0 bg-gradient-to-br from-blue-900/30 via-slate-900 to-slate-950 pointer-events-none">
            </div>
            <div class="absolute -top-24 -left-24 w-64 h-64 bg-blue-600/10 rounded-full blur-[80px]"></div>
            <div class="absolute -bottom-24 -right-24 w-64 h-64 bg-blue-400/10 rounded-full blur-[80px]"></div>

            <button onclick="window.closeWrapped()"
                class="absolute top-6 right-6 z-[6000] w-10 h-10 bg-white/5 hover:bg-white/10 rounded-full text-white/60 font-bold flex items-center justify-center backdrop-blur-md border border-white/10 transition-all">‚úï</button>

            <!-- Slide 1: Main Stats -->
            <div id="slide-1"
                class="wrapped-slide flex flex-col p-8 text-center relative z-10 flex-1 overflow-y-auto no-scrollbar">
                <div class="mt-4 mb-8">
                    <h2 class="text-white text-3xl font-black italic tracking-tighter uppercase leading-none mb-2">
                        Folkpresso<br><span class="text-blue-500">Wrapped</span>
                    </h2>
                    <p class="text-white/20 text-[10px] font-bold uppercase tracking-[0.2em]">Memories in every sip</p>
                </div>

                <div class="relative w-56 h-56 mx-auto mb-4 group flex items-center justify-center">
                    <div
                        class="absolute inset-0 bg-blue-500 rounded-full blur-[60px] opacity-20 group-hover:opacity-40 transition-opacity">
                    </div>
                    <img id="wrap-persona-icon-img" src="img/biji kopi.png"
                        class="w-full h-full object-cover rounded-[3rem] relative z-10 anim-brew"
                        style="filter: drop-shadow(0 20px 40px rgba(0,0,0,0.6));"
                        onerror="this.src='https://cdn-icons-png.flaticon.com/512/924/924514.png'">
                </div>

                <h4 class="text-4xl font-black text-white tracking-tighter leading-none" id="wrap-persona-title">Daily
                    Sipper</h4>
                <p class="text-blue-400 text-[10px] font-bold mt-2 mb-8 uppercase tracking-widest"
                    id="wrap-persona-desc">Coffee is your fuel.</p>

                <div class="grid grid-cols-2 gap-4 mb-6">
                    <div class="bg-white/5 backdrop-blur-md p-5 rounded-[2.5rem] border border-white/10">
                        <p class="text-[9px] text-white/40 font-bold uppercase tracking-widest mb-1">Total Cups</p>
                        <p class="text-4xl font-black text-white leading-none" id="wrap-total-cups">0</p>
                    </div>
                    <div class="bg-white/5 backdrop-blur-md p-5 rounded-[2.5rem] border border-white/10">
                        <p class="text-[9px] text-white/40 font-bold uppercase tracking-widest mb-1">Caffeine</p>
                        <p class="text-4xl font-black text-blue-500 leading-none"><span id="wrap-caffeine">0</span>
                        </p>
                    </div>
                </div>

                <div
                    class="bg-gradient-to-r from-blue-600/20 to-transparent p-0 rounded-[2.5rem] border border-white/5 mb-8 overflow-hidden h-24">
                    <div class="flex items-center gap-4 text-left h-full">
                        <div id="wrap-fav-img-div"
                            class="w-24 h-full bg-slate-800 shrink-0 overflow-hidden flex items-center justify-center">
                            <img id="wrap-fav-img" src="img/gula aren.png" class="w-full h-full object-cover scale-125">
                        </div>
                        <div class="pr-4">
                            <p
                                class="text-[8px] text-blue-400 font-bold uppercase tracking-widest mb-0.5 flex items-center gap-1">
                                Your Top Choice ‚òï
                            </p>
                            <h5 class="text-white font-black text-xl leading-tight" id="wrap-fav-name">Aren Latte</h5>
                            <p class="text-white/30 text-[9px]" id="wrap-fav-stats">Dipesan 14 kali</p>
                        </div>
                    </div>
                </div>

                <button onclick="shareWrapped()"
                    class="w-full py-4 bg-white text-slate-900 rounded-[2rem] font-black text-xs uppercase tracking-widest active:scale-95 transition-all shadow-xl flex items-center justify-center gap-2">
                    <span>üì§ Bagikan Momenmu</span>
                </button>
            </div>
        </div>
    </div>
    <div id="qris-modal"
        class="fixed inset-0 hidden z-[10000] flex items-center justify-center p-6 backdrop-blur-md bg-black/60 transition-all duration-300">
        <div class="bg-white dark:bg-slate-900 w-full max-w-sm rounded-[2.5rem] p-8 shadow-2xl text-center">
            <h3 class="text-xl font-black text-blue-900 dark:text-white mb-2">Scan QRIS</h3>
            <p class="text-xs text-slate-500 mb-6">SS halaman ini dan upload ke e-wallet kamu</p>

            <div class="bg-white p-4 rounded-3xl border-4 border-blue-50 mb-6 flex justify-center shadow-inner">
                <img id="qris-image" src="" alt="QRIS Code" class="w-64 h-64 object-contain">
            </div>

            <p class="text-2xl font-black text-blue-700 dark:text-blue-400 mb-6" id="qris-total">Rp 0</p>

            <button onclick="document.getElementById('qris-modal').classList.add('hidden')"
                class="w-full bg-blue-600 text-white py-4 rounded-2xl font-bold shadow-lg active:scale-95">Selesai</button>
        </div>
    </div>
    <div id="passport-modal"
        class="fixed inset-0 hidden z-[5000] flex items-center justify-center p-4 backdrop-blur-md bg-black/60 transition-all duration-300">
        <div
            class="bg-slate-900 w-full max-w-sm rounded-[3rem] shadow-[0_0_50px_rgba(0,0,0,0.5)] flex flex-col overflow-hidden max-h-[85vh] border border-blue-500/20">
            <div
                class="bg-gradient-to-b from-blue-900/40 to-slate-900 p-8 text-center relative border-b border-white/5">
                <div
                    class="absolute inset-0 bg-[url('https://www.transparenttextures.com/patterns/dark-matter.png')] opacity-20">
                </div>

                <button onclick="document.getElementById('passport-modal').classList.add('hidden')"
                    class="absolute top-6 right-6 text-white/40 hover:text-white bg-white/5 w-8 h-8 rounded-full flex items-center justify-center font-bold border border-white/10 transition-all">‚úï</button>

                <div class="text-4xl mb-2 drop-shadow-[0_0_15px_rgba(59,130,246,0.3)]">üìñ</div>
                <h3 class="text-xl font-black text-white uppercase tracking-tighter italic leading-none">Folk's BOOKLET
                </h3>

                <div id="prestige-badge"
                    class="hidden mt-1.5 inline-flex items-center gap-1.5 bg-blue-500/20 px-2 py-0.5 rounded-full border border-blue-500/40">
                    <span class="text-[7px] font-black text-blue-200 uppercase tracking-widest">Prestige</span>
                    <span id="prestige-level-text" class="text-xs font-black text-blue-400">0</span>
                </div>

                <p class="text-[10px] text-blue-200/40 font-bold uppercase tracking-[0.2em] mt-3">Explorer's Registry
                </p>

                <div class="mt-6 bg-slate-800/50 rounded-full h-1.5 w-full overflow-hidden border border-white/5">
                    <div id="passport-progress-bar"
                        class="bg-gradient-to-r from-blue-600 to-blue-400 h-full transition-all duration-1000 shadow-[0_0_15px_rgba(59,130,246,0.4)]"
                        style="width: 0%"></div>
                </div>
                <div class="flex justify-between items-center mt-2">
                    <span class="text-[8px] text-blue-500/50 font-bold uppercase">Collection Progress</span>
                    <span id="passport-progress-text" class="text-[10px] text-blue-400 font-extrabold italic">0 /
                        0</span>
                </div>
            </div>

            <div id="passport-list"
                class="min-h-[250px] flex-grow p-5 overflow-y-auto grid grid-cols-3 gap-4 content-start no-scrollbar bg-[url('https://www.transparenttextures.com/patterns/dark-matter.png')]">
                <!-- Stamps will be injected here -->
            </div>

            <div id="prestige-reset-section"
                class="hidden p-6 bg-gradient-to-r from-blue-600 to-indigo-700 text-center">
                <div class="mb-3 flex justify-center gap-2">
                    <span class="animate-bounce">üëë</span>
                    <p class="text-[10px] font-black text-white uppercase tracking-widest">Passport Elite Complete</p>
                    <span class="animate-bounce">üëë</span>
                </div>
                <button onclick="prestigeResetPassport()"
                    class="w-full bg-white text-blue-700 py-4 rounded-[1.5rem] font-black text-[10px] uppercase tracking-widest shadow-xl active:scale-95 transition-all hover:bg-blue-50">Reset
                    & Rebirth Challenge</button>
            </div>

            <div
                class="p-5 bg-slate-900 border-t border-white/5 mt-auto relative z-10 shadow-[0_-10px_20px_rgba(0,0,0,0.5)] rounded-b-[3rem] pb-8">
                <div class="flex items-center gap-2 mb-3">
                    <div class="h-px bg-white/5 flex-1"></div>
                    <h4 class="text-[8px] font-black text-blue-500/30 uppercase tracking-[0.4em]">Achievements</h4>
                    <div class="h-px bg-white/5 flex-1"></div>
                </div>
                <!-- FIXED CONTAINER: Responsive scroll for Android/iPhone -->
                <!-- Achievements Grid -->
                <div class="grid grid-cols-3 gap-2 px-1">
                    <div id="ms-explorer"
                        class="bg-white/5 p-3 rounded-[1.5rem] border border-white/10 opacity-30 transition-all duration-500 text-center h-24 flex flex-col items-center justify-center">
                        <div class="text-xl mb-1">ü•â</div>
                        <p class="text-[8px] font-black text-white uppercase tracking-tighter">Explorer</p>
                    </div>
                    <div id="ms-junkie"
                        class="bg-white/5 p-3 rounded-[1.5rem] border border-white/10 opacity-30 transition-all duration-500 text-center h-24 flex flex-col items-center justify-center">
                        <div class="text-xl mb-1">ü•à</div>
                        <p class="text-[8px] font-black text-white uppercase tracking-tighter">Addict</p>
                    </div>
                    <div id="ms-master"
                        class="bg-blue-500/10 p-3 rounded-[1.5rem] border border-blue-500/30 opacity-30 transition-all duration-500 text-center h-24 flex flex-col items-center justify-center relative shadow-[0_5px_15px_rgba(59,130,246,0.1)]">
                        <div class="text-2xl mb-1">üèÜ</div>
                        <p class="text-[8px] font-black text-white uppercase leading-tight">Master</p>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <script>
        // Registrasi Service Worker & Update Logic
        if ('serviceWorker' in navigator) {
            window.addEventListener('load', () => {
                navigator.serviceWorker.register('sw.js').then(reg => {
                    console.log('SW Registered!', reg);

                    // Deteksi jika ada update
                    reg.onupdatefound = () => {
                        const installingWorker = reg.installing;
                        installingWorker.onstatechange = () => {
                            if (installingWorker.state === 'installed') {
                                if (navigator.serviceWorker.controller) {
                                    // Ada update baru! Beritahu user
                                    if (window.showToast) window.showToast("üöÄ Versi baru tersedia! Mengupdate...");
                                    setTimeout(() => {
                                        window.location.reload();
                                    }, 2000);
                                }
                            }
                        };
                    };
                }).catch(err => console.error('SW Failed!', err));
            });
        }
    </script>
</body>

</html>